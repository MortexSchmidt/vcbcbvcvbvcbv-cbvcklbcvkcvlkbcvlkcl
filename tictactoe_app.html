<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        /* Dark, human-made flat UI — no gradients, readable, comfortable */
        :root{
            --bg: #0b0f14;          /* page background - very dark */
            --card: #0f1720;        /* cards and panels */
            --muted: #98a0b3;       /* secondary text (lighter for dark bg) */
            --text: #e6eef8;        /* primary text */
            --accent: #6c8cff;      /* accent color */
            --success: #22c55e;
            --danger: #ff6b6b;
            --glass: rgba(255,255,255,0.03);
            --shadow-1: 0 8px 28px rgba(2,6,23,0.6);
            --radius: 12px;
            --radius-sm: 8px;
            --gap: 14px;
            --transition: 180ms cubic-bezier(.2,.9,.2,1);
        }

        *{box-sizing:border-box}
        html,body{height:100%}
        body{
            margin:0;
            font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
            background:var(--bg);
            color:var(--text);
            -webkit-font-smoothing:antialiased;
            -moz-osx-font-smoothing:grayscale;
            display:flex;
            align-items:flex-start;
            justify-content:center;
            padding:10px 16px;
        }

        .app-container{
            width:100%;
            max-width:920px;
            border-radius:16px;
            overflow:hidden;
            box-shadow:var(--shadow-1);
            background:var(--card);
            display:grid;
            grid-template-columns: 320px 1fr;
            gap:22px;
            /* Make the container fill most of the viewport so inner sections can stretch */
            height:calc(100vh - 44px);
        }

        /* Sidebar */
        .app-sidebar{
            padding:18px;
            background:transparent;
            border-right:1px solid rgba(255,255,255,0.03);
            display:flex;
            flex-direction:column;
            gap:12px;
            height:100%;
        }

    .app-header{display:flex;align-items:center;gap:12px}
    .app-title{
      margin:0;font-weight:700;font-size:1.25rem;display:flex;align-items:center;gap:12px;color:var(--text)
    }
    .app-title i{color:var(--accent);font-size:1.4rem}

    .profile-row{display:flex;align-items:center;gap:12px}
    .avatar{
            width:56px;height:56px;max-width:56px;max-height:56px;border-radius:12px;flex:0 0 56px;overflow:hidden;background:var(--glass);display:flex;align-items:center;justify-content:center;font-weight:700;color:var(--card);
    }
    .avatar img{width:100%;height:100%;object-fit:cover}
        /* Normalize other avatar images across UI */
        .player-display-avatar-img, .lobby-player-avatar-img, .player-avatar-img, .player-display img {
            width:48px;height:48px;border-radius:8px;object-fit:cover;display:block;flex-shrink:0;
        }

    .profile-info{display:flex;flex-direction:column}
    .profile-name{font-weight:600}
    .profile-sub{font-size:0.9rem;color:var(--muted)}

    .menu-buttons{display:flex;flex-direction:column;gap:10px;margin-top:0}
    /* Menu buttons: allow wrapping, prevent icon wrap, consistent min height */
    .menu-btn{display:flex;align-items:center;gap:12px;padding:10px 12px;border-radius:10px;border:1px solid rgba(255,255,255,0.03);background:transparent;color:var(--text);cursor:pointer;transition:all var(--transition);font-weight:600;white-space:normal;word-break:break-word;text-align:left;min-height:48px;line-height:1.15;overflow-wrap:anywhere}
    .menu-btn i{width:28px;text-align:center;color:var(--accent);flex-shrink:0;flex-basis:28px}
    .menu-btn.primary{background:var(--accent);color:#07102a;border:0}
    .menu-btn.primary svg {
        margin-right: 6px; /* Уменьшаем отступ для лучшего отображения */
    }
    .menu-btn:hover{transform:translateY(-1px);box-shadow:0 6px 18px rgba(2,6,23,0.55)}

    /* Main area */
    .app-main{padding:22px;display:flex;flex-direction:column;gap:18px;background:transparent;height:100%}
    /* Sections keep the card background to ensure consistent dark surfaces */
    .section{background:var(--card);border-radius:12px;padding:16px;border:1px solid var(--glass)}
    .section-title{display:flex;align-items:center;gap:10px;font-weight:700;color:var(--text);margin:0 0 8px 0}
    .section-title i{color:var(--accent)}

    /* Оформление списка лобби */
.lobby-card {
    background: var(--card);
    border: 1px solid var(--glass);
    border-radius: var(--radius-sm);
    padding: 12px;
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.lobby-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.lobby-name {
    font-weight: 600;
    font-size: 1.1rem;
    color: var(--text);
}

.lobby-status {
    font-size: 0.9rem;
    color: var(--muted);
}

.lobby-players {
    display: flex;
    gap: 12px;
    align-items: center;
}

.player-info {
    display: flex;
    align-items: center;
    gap: 8px;
}

.player-avatar-img {
    width: 36px;
    height: 36px;
    border-radius: var(--radius-sm);
    object-fit: cover;
}

.player-details {
    display: flex;
    flex-direction: column;
}

.player-name {
    font-weight: 600;
    color: var(--text);
}

.player-symbol {
    font-size: 0.85rem;
    color: var(--muted);
}

.empty-slot {
    font-style: italic;
    color: var(--muted);
}

    .lobby-grid{display:flex;flex-direction:column;gap:12px;flex:1;justify-content:flex-end;overflow:auto;padding-top:6px}
    .lobby-card{
        background: var(--card);
        border: 1px solid var(--glass);
        border-radius: var(--radius-sm);
        padding: 12px;
        display: flex;
        flex-direction: column;
        gap: 8px;
    }
    .lobby-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    .lobby-name {
        font-weight: 600;
        font-size: 1.1rem;
        color: var(--text);
    }
    .lobby-status {
        font-size: 0.9rem;
        color: var(--muted);
    }
    .lobby-players {
        display: flex;
        gap: 12px;
        align-items: center;
    }
    .player-info {
        display: flex;
        align-items: center;
        gap: 8px;
    }
    .player-avatar-img {
        width: 36px;
        height: 36px;
        border-radius: var(--radius-sm);
        object-fit: cover;
    }
    .player-details {
        display: flex;
        flex-direction: column;
    }
    .player-name {
        font-weight: 600;
        color: var(--text);
    }
    .player-symbol {
        font-size: 0.85rem;
        color: var(--muted);
    }
    .empty-slot {
        font-style: italic;
        color: var(--muted);
    }

    .profile-info{display:flex;flex-direction:column}
    .profile-name{font-weight:600}
    .profile-sub{font-size:0.9rem;color:var(--muted)}

    .menu-buttons{display:flex;flex-direction:column;gap:10px;margin-top:0}
    /* Menu buttons: allow wrapping, prevent icon wrap, consistent min height */
    .menu-btn{display:flex;align-items:center;gap:12px;padding:10px 12px;border-radius:10px;border:1px solid rgba(255,255,255,0.03);background:transparent;color:var(--text);cursor:pointer;transition:all var(--transition);font-weight:600;white-space:normal;word-break:break-word;text-align:left;min-height:48px;line-height:1.15;overflow-wrap:anywhere}
    .menu-btn i{width:28px;text-align:center;color:var(--accent);flex-shrink:0;flex-basis:28px}
    .menu-btn.primary{background:var(--accent);color:#07102a;border:0}
    .menu-btn.primary svg {
        margin-right: 6px; /* Уменьшаем отступ для лучшего отображения */
    }
    .menu-btn:hover{transform:translateY(-1px);box-shadow:0 6px 18px rgba(2,6,23,0.55)}

    /* Main area */
    .app-main{padding:22px;display:flex;flex-direction:column;gap:18px;background:transparent;height:100%}
    /* Sections keep the card background to ensure consistent dark surfaces */
    .section{background:var(--card);border-radius:12px;padding:16px;border:1px solid var(--glass)}
    .section-title{display:flex;align-items:center;gap:10px;font-weight:700;color:var(--text);margin:0 0 8px 0}
    .section-title i{color:var(--accent)}

    /* На мобильных: скрываем все кнопки внутри карточек лобби */
    @media (max-width: 768px) {
        .lobby-card button,
        .lobby-card .menu-btn {
            display: none !important;
        }
        .lobby-card { cursor: pointer; }
        .lobby-card.selected { outline: 2px solid var(--accent); box-shadow: 0 6px 20px rgba(108,140,255,0.10); }
    }
    .play-button {
        position: fixed;
        left: 50%;
        bottom: 80px;
        transform: translateX(-50%);
        background: var(--accent);
        color: #fff;
        padding: 14px 32px;
        border-radius: var(--radius);
        font-size: 1.1rem;
        font-weight: 600;
        box-shadow: var(--shadow-1);
        display: none;
        z-index: 1000;
    }

    /* На мобильных: скрываем только кнопки внутри карточек лобби (не всю навигацию) */
    @media (max-width: 768px) {
        /* Кнопки общие (меню) остаются видимыми, но любые кнопки внутри карточек лобби скрываем */
        .lobby-card .menu-btn, .lobby-card button { display: none; }

        /* Улучшаем область нажатия для карточек лобби */
        .lobby-card { cursor: pointer; }

        /* Стиль выделенной карточки */
        .lobby-card.selected { outline: 2px solid rgba(108,140,255,0.18); box-shadow: 0 6px 20px rgba(108,140,255,0.06); }
    }
    </style>
</head>
<body>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <script>
        // Инициализация Telegram WebApp
        const tg = window.Telegram.WebApp;
        tg.expand();

        // Инициализация SocketIO клиента
        const socket = io('https://vcbcbvcvbvcbv-cbvcklbcvkcvlkbcvlkcl-production.up.railway.app');

        let currentUser = null;
        let currentLobby = null;

        // Авторизация при загрузке страницы
        tg.ready();

        socket.on('connect', () => {
            console.log('Подключено к серверу');

            // Отправляем данные пользователя при подключении
            if (tg.initDataUnsafe && tg.initDataUnsafe.user) {
                currentUser = {
                    user_id: tg.initDataUnsafe.user.id,
                    name: tg.initDataUnsafe.user.first_name || tg.initDataUnsafe.user.username || 'Игрок',
                    avatar: ''
                };

                socket.emit('identify', currentUser);
            }
        });

        // Обработка создания лобби
        document.querySelectorAll('.menu-btn.primary').forEach(btn => {
            btn.addEventListener('click', () => {
                if (btn.textContent.includes('Создать лобби')) {
                    socket.emit('create_lobby', {
                        name: 'Лобби игрока',
                        player_name: currentUser ? currentUser.name : 'Игрок',
                        player_avatar: currentUser ? currentUser.avatar : '',
                        user_id: currentUser ? currentUser.user_id : null
                    });
                }
            });
        });

        // Обработка получения списка лобби
        socket.on('lobbies_list', (lobbies) => {
            console.log('Получен список лобби:', lobbies);
        });

        // Обработка создания лобби
        socket.on('lobby_created', (data) => {
            console.log('Лобби создано:', data);
            currentLobby = data.lobby_id;
            tg.showAlert('Лобби создано! Ожидаем второго игрока...');
        });

        // Обработка обновления лобби
        socket.on('update_lobby', (lobby) => {
            console.log('Лобби обновлено:', lobby);
            if (lobby.status === 'playing') {
                tg.showAlert('Игра началась!');
            }
        });

        // Обработка ошибок
        socket.on('error', (error) => {
            console.error('Ошибка:', error);
            tg.showAlert('Ошибка: ' + error.message);
        });

        // Обработка отключения
        socket.on('disconnect', () => {
            console.log('Отключено от сервера');
        });

        document.addEventListener('DOMContentLoaded', () => {
            const isMobile = window.matchMedia && window.matchMedia('(max-width: 768px)').matches;
            const lobbyCards = document.querySelectorAll('.lobby-card');
            let playButton = document.querySelector('.play-button');
            if (!playButton) {
                playButton = document.createElement('button');
                playButton.className = 'play-button';
                playButton.textContent = 'Играть';
                document.body.appendChild(playButton);
            }
            let selectedCard = null;
            if (isMobile) {
                lobbyCards.forEach(card => {
                    card.addEventListener('click', (e) => {
                        e.stopPropagation();
                        if (selectedCard === card) {
                            card.classList.remove('selected');
                            selectedCard = null;
                            playButton.style.display = 'none';
                        } else {
                            if (selectedCard) selectedCard.classList.remove('selected');
                            selectedCard = card;
                            card.classList.add('selected');
                            playButton.style.display = 'block';
                        }
                    });
                });
                document.addEventListener('click', (event) => {
                    if (!event.target.closest('.lobby-card')) {
                        if (selectedCard) selectedCard.classList.remove('selected');
                        selectedCard = null;
                        playButton.style.display = 'none';
                    }
                });
                playButton.addEventListener('click', () => {
                    if (!selectedCard) return;
                    // Здесь можно добавить socket.emit('join_lobby', ...) или другую логику
                    const lobbyName = selectedCard.querySelector('.lobby-name')?.textContent || '';
                    if (window.Telegram && window.Telegram.WebApp) {
                        window.Telegram.WebApp.showAlert(lobbyName ? `Вы выбрали: ${lobbyName}` : 'Выбрана игра');
                    } else {
                        alert(lobbyName ? `Вы выбрали: ${lobbyName}` : 'Выбрана игра');
                    }
                });
            }
        });
    </script>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="app-sidebar">
            <!-- Header with title and profile -->
            <div class="app-header">
                <h1 class="app-title">
                    <i class="fas fa-gamepad"></i>
                    Игровое Сообщество
                </h1>
            </div>

            <!-- Profile section: avatar, name, and status -->
            <div class="profile-row">
                <div class="avatar">
                    <img src="https://via.placeholder.com/56" alt="Avatar">
                </div>
                <div class="profile-info">
                    <div class="profile-name">Имя Пользователя</div>
                    <div class="profile-sub">Онлайн</div>
                </div>
            </div>

            <!-- Navigation menu: buttons for different sections -->
            <div class="menu-buttons">
                <div class="menu-btn primary">
                    <i class="fas fa-plus"></i>
                    Создать лобби
                </div>
                <div class="menu-btn">
                    <i class="fas fa-users"></i>
                    Мои лобби
                </div>
                <div class="menu-btn">
                    <i class="fas fa-cog"></i>
                    Настройки
                </div>
                <div class="menu-btn">
                    <i class="fas fa-sign-out-alt"></i>
                    Выход
                </div>
            </div>
        </aside>

        <!-- Main content area -->
        <div class="app-main">
            <!-- Section: title and action button -->
            <div class="section">
                <h2 class="section-title">
                    <i class="fas fa-tachometer-alt"></i>
                    Панель управления
                </h2>
                <button class="menu-btn primary">
                    <i class="fas fa-plus"></i>
                    Создать новое лобби
                </button>
            </div>

            <!-- Section: statistics and quick actions -->
            <div class="section">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-title">Активные игроки</div>
                        <div class="stat-value">128</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-title">Созданные лобби</div>
                        <div class="stat-value">32</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-title">Завершенные игры</div>
                        <div class="stat-value">76</div>
                    </div>
                </div>

                <div class="quick-actions">
                    <button class="menu-btn">
                        <i class="fas fa-bolt"></i>
                        Быстрый матч
                    </button>
                    <button class="menu-btn">
                        <i class="fas fa-calendar-alt"></i>
                        Запланированные игры
                    </button>
                </div>
            </div>

            <!-- Section: active lobbies and players -->
            <div class="section">
                <h2 class="section-title">
                    <i class="fas fa-gamepad"></i>
                    Активные лобби
                </h2>
                <div class="lobby-grid">
                    <!-- Lobby card example -->
                    <div class="lobby-card">
                        <div class="lobby-header">
                            <div class="lobby-name">Лобби 1</div>
                            <div class="lobby-status">Ожидание игроков</div>
                        </div>
                        <div class="lobby-players">
                            <div class="player-info">
                                <div class="player-avatar-img">
                                    <img src="https://via.placeholder.com/36" alt="Player Avatar">
                                </div>
                                <div class="player-details">
                                    <div class="player-name">Игрок 1</div>
                                    <div class="player-symbol">Крестик</div>
                                </div>
                            </div>
                            <div class="player-info">
                                <div class="player-avatar-img">
                                    <img src="https://via.placeholder.com/36" alt="Player Avatar">
                                </div>
                                <div class="player-details">
                                    <div class="player-name">Игрок 2</div>
                                    <div class="player-symbol">Нолик</div>
                                </div>
                            </div>
                            <div class="empty-slot">Свободное место</div>
                        </div>
                    </div>
                    <!-- End of lobby card example -->

                    <!-- Repeat lobby cards as needed -->
                </div>
            </div>
        </div>
    </div>
</body>
</html>